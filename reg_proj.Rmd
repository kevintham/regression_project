---
title: "Efficiency comparisons between car transmission types"
author: "Kevin Tham"
date: "May 12, 2018"
output: 
  html_document:
    keep_md: true
  pdf_document: default
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
```

## Overview

In this report we will explore the relationship between a set of variables and miles per gallon (MPG) from a data set of a collection of cars. Specifically, we would like to answer the following two questions:

1. How different is the MPG between automatic and manual transmissions?
2. Is an automatic of manual transmission better for MPG?

Using the dataset `mtcars` we shall embark on a statistical study to address the above two questions.

## Exploratary Data Analysis

We begin the study by conducting some exploratory data analysis. First we load in required libraries:

```{r, message=FALSE}
if (!require("pacman"))
  install.packages("pacman", repos = "http://cran.us.r-project.org")
pacman::p_load(knitr, dplyr, ggplot2, GGally, tidyr, grid, gridExtra, car, broom, tibble)
```

Next we import and examine the dataset:

```{r}
data(mtcars)
head(mtcars)
str(mtcars)
```

Some of the variables are in the wrong data type and require coercion to the correct data type: 

```{r}
mtcars$am <- factor(mtcars$am, labels = c('automatic',' manual'))
mtcars$vs <- factor(mtcars$vs, labels = c('V-shaped', 'straight'))
mtcars$cyl <- ordered(mtcars$cyl)
mtcars$gear <- ordered(mtcars$gear)
```

We can make a direct comparison between the transmission type and MPG with a boxplot:



From the boxplot in Figure \ref{fig:box} we can conclude that from the dataset, cars with a manual transmission have a larger median MPG than cars with an automatic transmission. The MPG for cars with a manual transmission also appear to have a larger spread between the first and third quartiles.

In order to visualise the relationship of MPG and transmission type with the other variables we can utilise a pairplot, shown in Figure \ref{fig:pairs}. From the pairplot we can observe that many of the variables are fairly correlated with each other. 

In particular, we can see how the nominal variables clearly separate some of the numerical variables. For example, the variable `cyl`, the number of cylinders in the car engine, splits the variables `disp`, `hp` and `drat` into distinct groups. The transmission type `am` also splits `disp`, `hp` and `drat` into two groups. Now if `am` is correlated with some of the other variables, which one actually is the variable responsible for the effect on MPG? Or are they all equally responsible?

This suggests that it will be difficult to intepret linear regression results to answer question 2 due to confounding variables.


## Statistical Analysis

### Linear Model with a single variable

If we are only concerned with the bulk effect of transmission type on MPG disregarding other values, we can simply regress `mpg` on `am` and examine the regression coefficients.

```{r}
fit1 <- lm(mpg ~ am, data=mtcars)
tidy(fit1)
glance(fit1)
```

The coefficient of the linear model with only 1 variable is 7.25, with a p-value of 0.0002, indicating significance and that we should reject the null hypothesis. Therefore is a difference of 7.25 MPG between automatic and manual transmission types, neglecting adjustment for other variables. We note here that the R-squared value for this model is fairly low. This is expected as other variables that can explain the variance in MPG have not been included.

### Linear Model with multiple variables


```{r}
fit2 <- lm(mpg ~ ., data=mtcars)
tidy(fit2)
glance(fit2)
vif(fit2)
```

```{r}
fit21 <- lm(mpg ~ . - disp, mtcars)
vif21 <- as.data.frame(vif(fit21))
vif21 %>% rownames_to_column('var') %>% filter(GVIF^(1/(2*Df)) > 3) %>%
  column_to_rownames('var')

fit22 <- lm(mpg ~ . - wt, mtcars)
vif22 <- as.data.frame(vif(fit22))
vif22 %>% rownames_to_column('var') %>% filter(GVIF^(1/(2*Df)) > 3) %>%
  column_to_rownames('var')

fit23 <- lm(mpg ~ . - carb, mtcars)
vif23 <- as.data.frame(vif(fit23))
vif23 %>% rownames_to_column('var') %>% filter(GVIF^(1/(2*Df)) > 3) %>%
  column_to_rownames('var')

fit24 <- lm(mpg ~ . - hp, mtcars)
vif24 <- as.data.frame(vif(fit24))
vif24 %>% rownames_to_column('var') %>% filter(GVIF^(1/(2*Df)) > 3) %>%
  column_to_rownames('var')

fit3 <- step(fit2, trace=0)
tidy(fit3)
glance(fit3)
sqrt(vif(fit3))
```

## Appendix

```{r, fig.align='center', results='hold', fig.cap='\\label{fig:box}Box plot of MPG against transmission type.'}
ggplot(mtcars, aes(x=am,y=mpg)) +
  geom_boxplot()
```

```{r, fig.align='center', fig.width=11, fig.height=11, results='hold', fig.cap='\\label{fig:pairs}Pair plot of variables from mtcars dataset.'}
#ggpairs(mtcars, lower=list(combo=wrap('facethist',binwidth=0.8)))
```

```{r}
```